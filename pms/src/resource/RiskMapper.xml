<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
     
   <!-- public ArrayList<RiskBoard> rBoard() -->
<mapper namespace="pms.dao.RiskDao">
	<resultMap type="riskboard" id="riskMap"/>
	<select id="rBoard" resultMap="riskMap" parameterType="int">
	select *
 	from(
 		select rownum rnum, level, a.*
 		from RISKBOARD a
 		where risk_status='승인'
		start with risk_parent_no=0
		connect by prior risk_no = risk_parent_no
		order siblings by risk_no DESC
	)WHERE PROJECT_NO = #{project_no}
	</select>
	
	<select id="rBoard_request" resultMap="riskMap" parameterType="int">
		SELECT rownum rnum, b.* from(
			SELECT * FROM RISKBOARD 
			where risk_status='미승인'
			ORDER BY risk_no
			) b
			WHERE PROJECT_NO = #{project_no}
	</select>
	
	<!-- public void insertBoard(RiskBoard insert); -->
	<insert id="insertBoard" parameterType="riskboard">
		INSERT INTO riskboard values(
			riskBoard_seq.nextval,#{project_no},#{risk_title},
			#{risk_content},#{risk_category},
			0,sysdate,'미승인',#{risk_writer})
	</insert>
	<select id="getBoard" resultType="riskboard" parameterType="int">
		select * 
		from riskboard 
		where risk_no = #{risk_no}
	</select>
	<!-- public void uptStatus (UptStatus upt_satus) -->
	<update id="uptStatus" parameterType="uptstatus">
		UPDATE RISKBOARD 
		SET RISK_STATUS = #{risk_status}
		WHERE risk_no = #{risk_no}
	</update>
<!-- 	<select id="fileInfo" resultType="riskfile" parameterType="int"> -->
<!-- 		select * -->
<!-- 		from risk_file -->
<!-- 		where fno = #{fno} -->
<!-- 	</select> -->
	
	<!-- public void insertRiskFile(RiskFile riskfile) -->
	<insert id="insertRiskFile" parameterType="riskfile">
		INSERT INTO risk_file values(riskfile_seq.nextval,#{name},riskBoard_seq.currval,
				#{filename},#{filepath},sysdate)
	</insert>
	<select id="fileInfo" resultType="riskfile" parameterType="int">
		SELECT * FROM RISK_FILE
		WHERE rnum=#{rnum}
	</select>

</mapper>  
 